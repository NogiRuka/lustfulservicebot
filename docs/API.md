# 桜色服务助手 - API文档

## 📋 概述

本文档详细说明了桜色服务助手的所有可用命令、功能和API接口。

## 🎯 用户命令

### 基础命令

#### `/start`
- **描述**：启动机器人，显示欢迎界面
- **权限**：所有用户
- **用法**：`/start`
- **响应**：显示用户面板和功能按钮

#### `/help`
- **描述**：获取帮助信息
- **权限**：所有用户
- **用法**：`/help`
- **响应**：显示可用命令列表

### 用户功能

#### 反馈系统
- **描述**：用户可以直接发送消息进行反馈
- **权限**：所有用户
- **用法**：直接发送文本消息
- **响应**：确认收到反馈，管理员会收到通知

#### 求片功能
- **描述**：用户可以请求特定内容
- **权限**：所有用户
- **触发**：通过用户面板按钮
- **流程**：填写求片信息 → 提交审核 → 管理员处理

#### 投稿功能
- **描述**：用户可以提交内容投稿
- **权限**：所有用户
- **触发**：通过用户面板按钮
- **流程**：上传内容 → 填写信息 → 提交审核

## 🛠️ 管理员命令

### 代发消息系统

#### `/send_user` 或 `/su`
- **描述**：发送消息给指定用户
- **权限**：超管
- **用法**：`/su [用户ID] [消息内容]`
- **示例**：`/su 123456789 您好，这是来自管理员的消息`
- **响应**：
  - 成功：显示发送确认信息
  - 失败：显示错误原因
- **特性**：
  - 支持HTML格式
  - 自动记录到数据库
  - 支持回复追踪

#### `/send_channel` 或 `/sc`
- **描述**：发送消息到指定频道
- **权限**：超管
- **用法**：`/sc [频道ID] [消息内容]`
- **示例**：`/sc @mychannel 频道公告内容`
- **注意**：需要机器人在目标频道有发送权限

#### `/send_group` 或 `/sg`
- **描述**：发送消息到指定群组
- **权限**：超管
- **用法**：`/sg [群组ID] [消息内容]`
- **示例**：`/sg -1001234567890 群组通知内容`
- **注意**：需要机器人在目标群组有发送权限

### 回复管理系统

#### `/replies` 或 `/r`
- **描述**：查看用户回复列表
- **权限**：管理员、超管
- **用法**：`/replies`
- **响应**：显示未读回复列表，支持分页浏览
- **功能**：
  - 显示回复数量
  - 按时间排序
  - 支持标记已读

#### `/history` 或 `/h`
- **描述**：查看与指定用户的对话历史
- **权限**：管理员、超管
- **用法**：`/history [用户ID]`
- **示例**：`/h 123456789`
- **响应**：显示完整的对话记录

#### `/mark_read` 或 `/mr`
- **描述**：标记指定回复为已读
- **权限**：管理员、超管
- **用法**：`/mark_read [记录ID]`
- **示例**：`/mr 456`
- **响应**：确认标记成功

### 用户管理系统

#### `/add_admin`
- **描述**：添加管理员
- **权限**：超管
- **用法**：`/add_admin [用户ID]`
- **示例**：`/add_admin 123456789`
- **流程**：输入用户ID → 确认提升 → 完成

#### `/demote`
- **描述**：移除管理员权限
- **权限**：超管
- **用法**：`/demote [用户ID]`
- **示例**：`/demote 123456789`
- **响应**：确认降级成功

### 系统管理

#### `/view_settings`
- **描述**：查看系统设置
- **权限**：超管
- **用法**：`/view_settings`
- **响应**：显示所有系统配置项

#### `/toggle_feature`
- **描述**：切换功能开关
- **权限**：超管
- **用法**：`/toggle_feature [功能名]`
- **示例**：`/toggle_feature user_feedback`
- **可用功能**：
  - `user_feedback` - 用户反馈
  - `movie_requests` - 求片功能
  - `content_submission` - 内容投稿

#### `/set_setting`
- **描述**：设置系统配置
- **权限**：超管
- **用法**：`/set_setting [配置名] [值]`
- **示例**：`/set_setting max_file_size 50MB`

### 内容管理

#### `/add_category`
- **描述**：添加内容分类
- **权限**：超管
- **用法**：`/add_category [分类名]`
- **示例**：`/add_category 动作片`

#### `/edit_category`
- **描述**：编辑分类信息
- **权限**：超管
- **用法**：`/edit_category [分类ID] [新名称]`
- **示例**：`/edit_category 1 动作电影`

#### `/delete_category`
- **描述**：删除分类
- **权限**：超管
- **用法**：`/delete_category [分类ID]`
- **示例**：`/delete_category 1`

#### `/toggle_category`
- **描述**：启用/禁用分类
- **权限**：超管
- **用法**：`/toggle_category [分类ID]`
- **示例**：`/toggle_category 1`

### 图片管理

#### `/img_info` 或 `/ii`
- **描述**：查看图片库信息
- **权限**：超管
- **用法**：`/img_info`
- **响应**：显示图片数量和存储信息

#### `/img_add` 或 `/ia`
- **描述**：添加图片到图片库
- **权限**：超管
- **用法**：发送图片并使用 `/img_add`
- **响应**：确认添加成功

#### `/img_remove` 或 `/ir`
- **描述**：从图片库移除图片
- **权限**：超管
- **用法**：`/img_remove [图片ID]`
- **示例**：`/ir 123`

#### `/img_clear` 或 `/ic`
- **描述**：清空用户会话图片
- **权限**：超管
- **用法**：`/img_clear`
- **响应**：确认清空成功

### 开发日志管理

#### `/add_changelog`
- **描述**：添加开发日志
- **权限**：超管
- **用法**：`/add_changelog [版本] [内容]`
- **示例**：`/add_changelog v1.1.0 添加新功能`

#### `/edit_changelog`
- **描述**：编辑开发日志
- **权限**：超管
- **用法**：`/edit_changelog [日志ID] [新内容]`
- **示例**：`/edit_changelog 1 修复bug`

#### `/del_changelog`
- **描述**：删除开发日志
- **权限**：超管
- **用法**：`/del_changelog [日志ID]`
- **示例**：`/del_changelog 1`

## 🔘 按钮交互

### 用户面板按钮

- **我的信息** - 查看个人信息和统计
- **服务器信息** - 查看服务器状态
- **其他功能** - 访问扩展功能
- **帮助** - 获取使用帮助
- **清空聊天记录** - 清除当前对话

### 管理员面板按钮

- **管理中心** - 访问管理功能
- **用户管理** - 管理用户和权限
- **系统设置** - 配置系统参数
- **内容管理** - 管理分类和内容
- **图片管理** - 管理图片库
- **开发日志** - 查看和管理更新日志

## 📊 数据结构

### 用户信息
```json
{
  "user_id": 123456789,
  "username": "user123",
  "full_name": "张三",
  "role": "user",
  "is_busy": false,
  "last_activity": "2025-09-06T22:30:00Z",
  "created_at": "2025-09-01T10:00:00Z"
}
```

### 消息记录
```json
{
  "id": 456,
  "admin_id": 987654321,
  "target_type": "user",
  "target_id": 123456789,
  "message_content": "测试消息",
  "sent_at": "2025-09-06T22:30:00Z",
  "has_replies": true,
  "is_read": false
}
```

### 回复记录
```json
{
  "id": 789,
  "sent_message_id": 456,
  "user_id": 123456789,
  "reply_content": "收到消息",
  "replied_at": "2025-09-06T22:35:00Z",
  "is_read": false
}
```

## 🔒 权限系统

### 权限级别

1. **普通用户 (user)**
   - 使用基础功能
   - 发送反馈
   - 求片和投稿

2. **管理员 (admin)**
   - 查看用户回复
   - 查看对话历史
   - 标记回复已读

3. **超级管理员 (superadmin)**
   - 所有管理员权限
   - 代发消息
   - 用户管理
   - 系统设置
   - 内容管理

### 权限检查

所有管理员命令都会进行权限验证：
- 检查用户角色
- 验证命令权限
- 记录操作日志

## 🚨 错误处理

### 常见错误码

- **403** - 权限不足
- **404** - 用户或资源不存在
- **400** - 参数错误
- **500** - 服务器内部错误

### 错误响应格式

```
❌ 错误信息

📤 目标：[目标信息]
❌ 错误：[具体错误]
💡 建议：[解决建议]
```

## 📈 监控和日志

### 日志级别

- **DEBUG** - 调试信息
- **INFO** - 一般信息
- **WARNING** - 警告信息
- **ERROR** - 错误信息

### 监控指标

- 消息发送成功率
- 用户活跃度
- 系统响应时间
- 错误发生频率

## 🔄 API版本

当前版本：**v1.0.0**

### 版本历史

- **v1.0.0** (2025-09-06)
  - 初始版本发布
  - 完整的代发消息系统
  - 回复追踪功能
  - 用户管理系统
  - 反馈处理功能

## 📞 技术支持

如需技术支持，请：

1. 查看日志文件：`/opt/lustfulservicebot/logs/`
2. 检查系统状态：`systemctl status lustfulservicebot`
3. 查看错误信息：`journalctl -u lustfulservicebot -f`
4. 联系开发团队

---

**注意**：本文档会随着功能更新而持续更新，请定期查看最新版本。