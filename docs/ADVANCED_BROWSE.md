# 高级浏览系统使用指南

## 概述

高级浏览系统为管理员提供了强大的数据浏览和管理功能，支持：

- ✅ **自定义每页显示条数** (5-50条)
- ✅ **灵活的页面跳转** (首页、末页、上下页、指定页)
- ✅ **多字段排序** (创建时间、更新时间、审核时间等)
- ✅ **排序方向控制** (升序/降序，默认早的在前)
- ✅ **自定义显示字段** (选择显示哪些信息)
- ✅ **实时刷新** (获取最新数据)
- ✅ **状态过滤** (按状态筛选数据)

## 支持的浏览模块

### 1. 求片请求浏览
**命令**: `/browse_requests`

**功能**:
- 浏览所有求片请求
- 按状态过滤 (待审核/已通过/已拒绝)
- 显示分类信息
- 支持快速审核操作

**默认显示字段**:
- ID
- 标题
- 状态
- 创建时间
- 用户ID

### 2. 投稿内容浏览
**命令**: `/browse_submissions`

**功能**:
- 浏览所有投稿内容
- 按状态过滤
- 显示分类和内容预览
- 支持快速审核

**默认显示字段**:
- ID
- 标题
- 状态
- 创建时间
- 用户ID

### 3. 用户反馈浏览
**命令**: `/browse_feedback`

**功能**:
- 浏览用户反馈
- 按状态和类型过滤
- 显示反馈类型和处理状态
- 支持快速回复

**默认显示字段**:
- ID
- 反馈类型
- 状态
- 创建时间
- 用户ID

### 4. 用户信息浏览
**命令**: `/browse_users`

**功能**:
- 浏览所有用户
- 按角色过滤
- 显示用户详细信息
- 支持用户管理操作

**默认显示字段**:
- ID
- 用户名
- 全名
- 角色
- 创建时间

## 界面操作指南

### 导航控制

```
⏮️ 首页    ◀️ 上页    📄 2/10    ▶️ 下页    ⏭️ 末页
           ⚙️ 浏览设置              🔄 刷新
```

- **⏮️ 首页**: 跳转到第一页
- **◀️ 上页**: 跳转到上一页
- **📄 页码**: 显示当前页/总页数，点击可跳转到指定页
- **▶️ 下页**: 跳转到下一页
- **⏭️ 末页**: 跳转到最后一页
- **⚙️ 浏览设置**: 打开设置面板
- **🔄 刷新**: 刷新当前页面数据

### 设置面板

```
📊 每页: 10条
📅 排序: created_at    🔄 顺序: 升序
🏷️ 显示字段
↩️ 返回浏览
```

#### 每页条数设置
点击 **📊 每页: X条** 可选择：
- 5条、10条、15条、20条、30条、50条

#### 排序设置
- **📅 排序字段**: 创建时间、更新时间、审核时间、回复时间
- **🔄 排序顺序**: 升序(早的在前) / 降序(晚的在前)

#### 显示字段设置
可自定义显示哪些字段：
- 基础信息: ID、标题、状态
- 时间信息: 创建时间、更新时间、审核时间
- 用户信息: 用户ID、用户名
- 分类信息: 分类ID、分类名称
- 其他信息: 描述、备注等

## 使用示例

### 示例1: 查看最新的求片请求

1. 发送 `/browse_requests`
2. 点击 **⚙️ 浏览设置**
3. 点击 **🔄 顺序: 升序** 切换为降序
4. 点击 **↩️ 返回浏览**
5. 现在显示最新的求片请求在前

### 示例2: 每页显示更多内容

1. 在任意浏览界面点击 **⚙️ 浏览设置**
2. 点击 **📊 每页: 10条**
3. 选择 **30条**
4. 自动返回浏览界面，现在每页显示30条记录

### 示例3: 查看待处理的反馈

1. 发送 `/browse_feedback`
2. 系统自动按创建时间升序显示
3. 使用导航按钮浏览不同页面
4. 点击具体反馈进行处理

## 技术特性

### 性能优化
- **分页查询**: 只加载当前页数据，减少内存占用
- **索引优化**: 数据库查询使用索引，提高查询速度
- **缓存机制**: 用户设置本地缓存，减少重复配置

### 用户体验
- **状态保持**: 每个用户的浏览设置独立保存
- **智能导航**: 根据当前页面智能显示导航按钮
- **错误处理**: 完善的错误处理和用户提示

### 扩展性
- **模块化设计**: 易于添加新的浏览模块
- **配置灵活**: 支持自定义默认配置
- **格式化器**: 支持自定义字段显示格式

## 开发者指南

### 添加新的浏览模块

1. **创建数据查询函数**:
```python
async def get_your_data_advanced(
    offset: int = 0,
    limit: int = 10,
    sort_field: str = "created_at",
    sort_order: str = "asc",
    # 其他过滤参数
) -> Dict[str, Any]:
    # 实现查询逻辑
    return {'items': items, 'total': total_count}
```

2. **创建浏览器实例**:
```python
from app.utils.advanced_browser import AdvancedBrowser, BrowserConfig

your_browser = AdvancedBrowser(
    get_your_data_advanced,
    BrowserConfig(
        page_size=10,
        visible_fields=['id', 'name', 'status', 'created_at']
    )
)
```

3. **添加命令处理器**:
```python
@router.message(Command("browse_your_data"), IsAdmin())
async def browse_your_data_command(message: Message):
    user_id = str(message.from_user.id)
    data = await your_browser.get_page_data(user_id, 1)
    # 格式化和显示逻辑
```

4. **添加回调处理器**:
```python
@router.callback_query(F.data.startswith("browse_your_data_"))
async def handle_your_data_browser_callback(callback: CallbackQuery):
    await handle_browser_callback(callback, your_browser, "您的数据浏览")
```

### 自定义字段格式化

```python
field_formatters = {
    'status': lambda x: {'pending': '待处理', 'done': '已完成'}.get(x, x),
    'created_at': lambda x: x.strftime('%m-%d %H:%M') if x else '无',
    'user_id': lambda x: f"用户{x}"
}

item_text = browser.format_item_display(
    item, 
    visible_fields, 
    field_formatters
)
```

## 常见问题

### Q: 为什么有些字段显示为"无"？
A: 这表示该字段在数据库中为空值(NULL)，这是正常现象。

### Q: 如何重置浏览设置？
A: 目前需要重新发送浏览命令，系统会使用默认设置。后续版本会添加重置功能。

### Q: 每页最多能显示多少条？
A: 为了保证性能和用户体验，每页最多显示50条记录。

### Q: 排序字段不生效怎么办？
A: 确保选择的排序字段在当前数据表中存在，如果问题持续请联系开发者。

## 更新日志

### v1.0.0 (2025-01-05)
- ✅ 初始版本发布
- ✅ 支持求片、投稿、反馈、用户浏览
- ✅ 完整的分页和排序功能
- ✅ 自定义显示字段
- ✅ 响应式导航界面

---

**注意**: 此功能仅对管理员开放，普通用户无法使用浏览命令。